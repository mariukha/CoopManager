Politechnika Świętokrzyska
Wydział Elektrotechniki Automatyki i Informatyki
Bazy Danych - Laboratorium
Numer grupy: 2ID13A
Zespół laboratoryjny: Maksym Mariukha, Daniil Reznik, Artem Labunskyi
Wyniki prac laboratoryjnych z instrukcji 9
Data wykonania ćwiczenia: 26.11.2025

Przebieg laboratorium

-- Zadanie 1: Rozpocznij zapis wyników
SPOOL wyniki_log.txt

-- Zadanie 2: Widoki proste (na podstawie zapytań z Lab 8)

CREATE OR REPLACE VIEW V_MIESZKANIA_ALL AS
SELECT * FROM mieszkanie;

SELECT * FROM V_MIESZKANIA_ALL;

CREATE OR REPLACE VIEW V_PRACOWNICY_INFO AS
SELECT id_pracownika, imie, nazwisko 
FROM pracownik;

SELECT * FROM V_PRACOWNICY_INFO;

-- Zadanie 3: Widoki złożone (na podstawie zapytań z Lab 8)

CREATE OR REPLACE VIEW V_SREDNIE_OPLATY AS
SELECT id_czlonka, AVG(kwota) AS srednia_kwota
FROM oplata
GROUP BY id_czlonka;

SELECT * FROM V_SREDNIE_OPLATY;

CREATE OR REPLACE VIEW V_USLUGI_OPIS AS
SELECT nazwa_uslugi,
       stan,
       CASE
           WHEN stan = 'Aktywna' THEN 'Działa'
           WHEN stan = 'Oczekuje' THEN 'W trakcie realizacji'
           ELSE 'Zakończona/Inny'
       END AS opis_stanu
FROM uslugi;

SELECT * FROM V_USLUGI_OPIS;

-- Zadanie 4: Widoki zmaterializowane (Materialized Views)

CREATE MATERIALIZED VIEW MV_BUDYNKI_DANE
BUILD IMMEDIATE
REFRESH FORCE ON DEMAND
AS
SELECT id_budynku, adres, rok_budowy FROM budynek;

SELECT * FROM MV_BUDYNKI_DANE;

INSERT INTO budynek (id_budynku, adres, rok_budowy) VALUES (100, 'Testowa MV 1', SYSDATE);
COMMIT;

BEGIN
    DBMS_MVIEW.REFRESH('MV_BUDYNKI_DANE');
END;
/

SELECT * FROM MV_BUDYNKI_DANE;

CREATE MATERIALIZED VIEW MV_NAPRAWY_STATUS
BUILD IMMEDIATE
REFRESH FORCE ON DEMAND
AS
SELECT status, COUNT(*) AS ilosc FROM naprawa GROUP BY status;

SELECT * FROM MV_NAPRAWY_STATUS;

INSERT INTO naprawa(id_naprawy, id_pracownika, id_mieszkania, data_zgloszenia, status) 
VALUES (888, 50001, 407, SYSDATE, 'Awaria');
COMMIT;

BEGIN
    DBMS_MVIEW.REFRESH('MV_NAPRAWY_STATUS');
END;
/

SELECT * FROM MV_NAPRAWY_STATUS;

-- Zadanie 5: Widoki niewidzialne (Invisible Views)

CREATE OR REPLACE VIEW V_KONTO_SAFE (id_konta, numer_konta, stan INVISIBLE) AS
SELECT id_konta, numer_konta, stan FROM konto_bankowe;

-- Wywołanie (pokaże tylko ID i numer, bez stanu)
SELECT * FROM V_KONTO_SAFE;

CREATE OR REPLACE VIEW V_CZLONEK_SAFE (id_czlonka, nazwisko, telefon INVISIBLE) AS
SELECT id_czlonka, nazwisko, numer_telefonu FROM czlonek;

SELECT * FROM V_CZLONEK_SAFE;

-- Zadanie 6: Widoki aktualizowalne

CREATE OR REPLACE VIEW V_UPD_SPOTKANIE AS
SELECT id_spotkania, temat, miejsce FROM spotkanie_mieszkancow;

UPDATE V_UPD_SPOTKANIE SET miejsce = 'Sala Zebrań' WHERE id_spotkania = 999;

SELECT * FROM spotkanie_mieszkancow WHERE id_spotkania = 999;

CREATE OR REPLACE VIEW V_UPD_USLUGA AS
SELECT id_uslugi, stan FROM uslugi;

UPDATE V_UPD_USLUGA SET stan = 'Zakonczona' WHERE id_uslugi = 1;

SELECT * FROM uslugi WHERE id_uslugi = 1;

-- Zadanie 7: Widoki Inline (zdefiniowane w zapytaniu)

SELECT t.numer, t.powierzchnia
FROM (SELECT numer, powierzchnia FROM mieszkanie WHERE powierzchnia > 40) t;

SELECT p.nazwisko, p.stanowisko_pracy
FROM (SELECT nazwisko, stanowisko_pracy FROM pracownik WHERE id_budynku = 1) p;

-- Zadanie 8: Zakończ zapis
SPOOL OFF;

Zawartość pliku wyniki_log.txt:

View V_MIESZKANIA_ALL created.


ID_MIESZKANIA POWIERZCHNIA NUMER      LICZBA_POKOI ID_BUDYNKU
------------- ------------ ---------- ------------ ----------
          407         50.5 407                   2          1
          409           65 409                   3          1
          101           30 101                   1          2


View V_PRACOWNICY_INFO created.


ID_PRACOWNIKA IMIE                           NAZWISKO
------------- ------------------------------ ------------------------------
        50001 Bartosz                        Kaczmar
        50002 Bartosz                        Wisniewski
        50003 Anna                           Kowalska


View V_SREDNIE_OPLATY created.


ID_CZLONKA SREDNIA_KWOTA
---------- -------------
         1          5343
         2           600
         3           900


View V_USLUGI_OPIS created.


NAZWA_USLUGI                   STAN                           OPIS_STANU
------------------------------ ------------------------------ --------------------
Internet                       Aktywna                        Działa
Telewizja                      Aktywna                        Działa
Internet                       Oczekuje                       W trakcie realizacji


Materialized view MV_BUDYNKI_DANE created.


ID_BUDYNKU ADRES                                              ROK_BUDOW
---------- -------------------------------------------------- ---------
         1 Al. Tysiaclecia PP 17a                             23-JUL-76
         2 ul. Sienkiewicza 283                               02-OCT-83
         3 ul. Marszałkowska 52                               15-MAY-32


1 row inserted.


Commit complete.


PL/SQL procedure successfully completed.


ID_BUDYNKU ADRES                                              ROK_BUDOW
---------- -------------------------------------------------- ---------
         1 Al. Tysiaclecia PP 17a                             23-JUL-76
         2 ul. Sienkiewicza 283                               02-OCT-83
         3 ul. Marszałkowska 52                               15-MAY-32
       100 Testowa MV 1                                       02-DEC-25


Materialized view MV_NAPRAWY_STATUS created.


STATUS                              ILOSC
------------------------------ ----------
W toku                                  1
Oczekuje                                1
Zakonczona                              1


1 row inserted.


Commit complete.


PL/SQL procedure successfully completed.


STATUS                              ILOSC
------------------------------ ----------
Awaria                                  1
W toku                                  1
Oczekuje                                1
Zakonczona                              1


View V_KONTO_SAFE created.


  ID_KONTA NUMER_KONTA
---------- ------------------------------
        10 PL49102028922276300500000000
        11 PL61109010140000071219812874
        12 PL32105010251000009080000000


View V_CZLONEK_SAFE created.


ID_CZLONKA NAZWISKO
---------- ------------------------------
         1 Mariukha
         2 Bak
         3 Reznik


View V_UPD_SPOTKANIE created.


1 row updated.


ID_SPOTKANIA TEMAT                                              MIEJSCE                                            DATA
------------ -------------------------------------------------- -------------------------------------------------- ---------
         999 Wprowadzenia                                       Sala Zebrań                                        22-NOV-25


View V_UPD_USLUGA created.


1 row updated.


 ID_USLUGI NAZWA_USLUGI                   DATA_USLU STAN                           ID_CZLONKA
---------- ------------------------------ --------- ------------------------------ ----------
         1 Internet                       01-DEC-25 Zakonczona                              1


NUMER      POWIERZCHNIA
---------- ------------
407                50.5
409                  65


NAZWISKO                       STANOWISKO_PRACY
------------------------------ ------------------------------
Kaczmar                        portiernia#1


Wniosek. Podczas laboratorium zrealizowaliśmy wszystkie zadania, co pozwoliło na praktyczne przećwiczenie tworzenia i zarządzania perspektywami (widokami) w bazie danych. Przetestowaliśmy tworzenie widoków prostych, złożonych z funkcjami agregującymi oraz widoków zdefiniowanych wewnątrz zapytania (Inline Views). Zweryfikowaliśmy działanie zaawansowanych mechanizmów, takich jak widoki zmaterializowane (Materialized Views) z opcją odświeżania oraz widoki z ukrytymi kolumnami i aktualizowalne. Laboratorium potwierdziło umiejętność efektywnego udostępniania danych, ukrywania złożoności struktury bazy oraz optymalizacji zapytań za pomocą widoków.
